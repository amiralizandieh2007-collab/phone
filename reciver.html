<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
<script>
  const peer = new Peer();
  const callBtn = document.getElementById('callBtn');
  const peerIdInput = document.getElementById('peerId');
  const info = document.getElementById('info');
  const remoteVideo = document.getElementById('remoteVideo');

  peer.on('open', id => {
    info.textContent = "گیرنده آماده است.";
    console.log('Receiver Peer ID:', id);
  });

  callBtn.addEventListener('click', () => {
    const target = (peerIdInput.value || "").trim();
    if (!target) return alert('لطفاً آیدی فرستنده را وارد کن.');
    
    info.textContent = "در حال تلاش برای اتصال...";

    // تماس خروجی بدون استریم
    const call = peer.call(target, undefined);

    if (!call) {
      info.textContent = "اتصال برقرار نشد (call undefined).";
      return;
    }

    call.on('stream', stream => {
      remoteVideo.srcObject = stream;
      info.textContent = "ویدئو دریافت شد.";
    });

    call.on('close', () => {
      info.textContent = "تماس بسته شد.";
    });

    call.on('error', err => {
      console.error(err);
      info.textContent = "خطا در اتصال: " + err.message;
    });
  });
</script>
